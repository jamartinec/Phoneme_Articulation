---
title: "presentation_helper"
output: html_document
---



#| label: setup
library(tidyverse)
library(ggplot2)
library(scales)
library(ggrepel)

#| label: crow-read
read_crow_mcleod <- function(file_path = "../Modeling_Pipeline/data/preprocessed/crow-mcleod.csv") {
  crow_mcleod <- read.csv(file_path)

  crow_mcleod_long <- crow_mcleod %>%
    transmute(
      expected_phoneme = phoneme,
      group,
      `0.50` = fifty_percent,
      `0.75` = seventyfive_percent,
      `0.90` = ninety_percent
    ) %>%
    pivot_longer(
      cols = c(`0.50`, `0.75`, `0.90`),
      names_to = "prob_x_eq_1_hat",
      values_to = "age_months"
    ) %>%
    mutate(
      prob_x_eq_1_hat = as.numeric(prob_x_eq_1_hat),
      age_months = as.numeric(round(age_months, 0))
    )

  crow_mcleod_long_sd <- crow_mcleod %>%
    transmute(
      expected_phoneme = phoneme,
      group,
      `0.50` = fifty_sd,
      `0.75` = seventyfive_sd,
      `0.90` = ninety_sd
    ) %>%
    pivot_longer(
      cols = c(`0.50`, `0.75`, `0.90`),
      names_to = "prob_x_eq_1_hat",
      values_to = "age_months_sd"
    ) %>%
    mutate(
      prob_x_eq_1_hat = as.numeric(prob_x_eq_1_hat),
      age_months_sd   = as.numeric(round(age_months_sd, 0))
    )

  crow_joined <- crow_mcleod_long %>%
    left_join(
      crow_mcleod_long_sd,
      by = c("expected_phoneme", "group", "prob_x_eq_1_hat")
    ) %>%
    mutate(
      age_months_m2sd = age_months - 2 * age_months_sd,
      age_months_p2sd = age_months + 2 * age_months_sd
    )

  crow_joined
}

cons_list <- c("Y", "T", "R", "L", "NG", "S", "Z", "SH", "ZH", "CH")
crow_joined <- read_crow_mcleod()
crow_joined <- crow_joined %>%
  filter(expected_phoneme %in% cons_list)

#| label: crow-plot
#| fig-width: 8
#| fig-height: 6
crow_plot_data <- crow_joined %>%
  mutate(
    cm_cut = case_when(
      prob_x_eq_1_hat == 0.50 ~ "50% accuracy",
      prob_x_eq_1_hat == 0.75 ~ "75% accuracy",
      prob_x_eq_1_hat == 0.90 ~ "90% accuracy"
    )
  )

crow_plot_data2 <- crow_plot_data %>%
  mutate(
    crit = factor(
      prob_x_eq_1_hat,
      levels = c(0.50, 0.75, 0.90),
      labels = c("50%", "75%", "90%")
    )
  )

ggplot(
  crow_plot_data2,
  aes(y = crit, colour = cm_cut)
) +
  geom_segment(
    aes(
      x    = age_months_m2sd,
      xend = age_months_p2sd,
      yend = crit
    ),
    linewidth = 1.2
  ) +
  geom_point(
    aes(x = age_months),
    size = 2.5
  ) +
  facet_wrap(~ expected_phoneme, scales = "free_y") +
  scale_colour_manual(
    name = "C&M cuts",
    values = c(
      "50% accuracy" = "red",
      "75% accuracy" = "darkgreen",
      "90% accuracy" = "purple"
    )
  ) +
  scale_x_continuous(
    name = "Age (years)",
    labels = function(x) x / 12,
    breaks = seq(0, max(crow_plot_data2$age_months), by = 12)
  ) +
  labs(
    y = "Accuracy (%)",
    x = "Age (months)",
    title = "Crowe & McLeod (2020): Ages of Acquisition (mean +/- 2sd)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    strip.text = element_text(face = "bold"),
    axis.title = element_text(face = "bold")
  ) +
  guides(colour = "none")

